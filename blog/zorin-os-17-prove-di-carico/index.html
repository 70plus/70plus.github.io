<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Quanta memoria utilizza il mio Linux? - 70plus - and still a lot to do</title><meta name="description" content="Quanta memoria utilizza il mio Linux?"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://70plus.it/blog/zorin-os-17-prove-di-carico/"><link rel="alternate" type="application/atom+xml" href="https://70plus.it/feed.xml"><link rel="alternate" type="application/json" href="https://70plus.it/feed.json"><meta property="og:title" content="Quanta memoria utilizza il mio Linux?"><meta property="og:image" content="https://70plus.it/media/posts/31/zorinos17.jpg"><meta property="og:image:width" content="912"><meta property="og:image:height" content="767"><meta property="og:site_name" content="70plus - and still a lot to do"><meta property="og:description" content="Quanta memoria utilizza il mio Linux?"><meta property="og:url" content="https://70plus.it/blog/blog/zorin-os-17-prove-di-carico/"><meta property="og:type" content="article"><link rel="stylesheet" href="https://70plus.it/assets/css/style.css?v=5426a87339835aa9a7dbb3dea13d905c"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://70plus.it/blog/zorin-os-17-prove-di-carico/"},"headline":"Quanta memoria utilizza il mio Linux?","datePublished":"2023-12-30T08:31","dateModified":"2024-03-24T10:10","image":{"@type":"ImageObject","url":"https://70plus.it/media/posts/31/zorinos17.jpg","height":767,"width":912},"description":"Quanta memoria utilizza il mio Linux?","author":{"@type":"Person","name":"Pasquale","url":"https://70plus.it/authors/pasquale/"},"publisher":{"@type":"Organization","name":"Pasquale"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript><link rel="me" href="https://mastodon.uno/@pasqualepetrosino"></head><body class="post-template"><script src="https://swetrix.org/swetrix.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', function() {
    swetrix.init('WoH0No9arSTq')
    swetrix.trackViews()
  })</script><noscript><img src="https://api.swetrix.com/log/noscript?pid=WoH0No9arSTq" alt="" referrerpolicy="no-referrer-when-downgrade"></noscript><div class="container js-container"><nav class="menu"><ul class="navbar__menu"><li><a href="https://70plus.it/" target="_self">Home</a></li><li class="has-submenu"><span>Argomenti</span><ul class="navbar__submenu"><li><a href="https://70plus.it/tags/numeri/" target="_self">Numeri</a></li><li><a href="https://70plus.it/tags/cose-informatiche/" target="_self">Cose informatiche</a></li><li><a href="https://70plus.it/tags/cucina/" target="_self">Cucina</a></li><li><a href="https://70plus.it/tags/pensieri/" target="_self">Pensieri</a></li><li><a href="https://70plus.it/tags/ricordi/" target="_self">Ricordi</a></li><li><a href="https://70plus.it/tags/produttivita/" title="Produttività" target="_self">Produttività</a></li></ul></li><li class="has-submenu"><a href="https://70plus.it/blog/javascript/" target="_self">Javascript</a><ul class="navbar__submenu"><li><a href="tris1.html" target="_self">Tris</a></li><li><a href="lunaplay.html" target="_self">LunaPlay</a></li><li><a href="quantonesai.html" target="_self">Quanto ne sai?</a></li><li><a href="cliccami.html" target="_self">Cliccami!</a></li></ul></li><li><a href="https://70plus.it/blog/ambienti-online-per-python/" target="_self">Ambienti online per Python</a></li><li><a href="https://70plus.it/blog/la-cucina-vista-da-me/" target="_self">La cucina vista da me</a></li><li><a href="https://70plus.it/blog/cookies-e-privacy-policy/" target="_self">Cookie e Privacy Policy</a></li><li><a href="https://70plus.it/blog/su-di-me/" title="Su di me" target="_self">Su di me</a></li></ul></nav><div class="container__content"><header class="top"><div class="top__item"><a class="logo" href="https://70plus.it/">70plus - and still a lot to do</a></div><div class="top__item top__item--right"><button class="menu-toggle js-menu-toggle" aria-label="Menu" aria-expanded="false"><span class="menu-toggle-box"><span class="menu-toggle-inner">Menu</span></span></button></div></header><main class="main post"><article class="content"><div class="main__left"><figure class="hero"><img src="https://70plus.it/media/posts/31/zorinos17.jpg" srcset="https://70plus.it/media/posts/31/responsive/zorinos17-xs.jpg 300w, https://70plus.it/media/posts/31/responsive/zorinos17-sm.jpg 480w, https://70plus.it/media/posts/31/responsive/zorinos17-md.jpg 768w, https://70plus.it/media/posts/31/responsive/zorinos17-lg.jpg 1024w, https://70plus.it/media/posts/31/responsive/zorinos17-xl.jpg 1280w, https://70plus.it/media/posts/31/responsive/zorinos17-2xl.jpg 1600w" sizes="(min-width: 1800px) 50vw, (min-width: 900px) 40vw, 100vw" loading="eager" height="767" width="912" alt="Zorin OS 17 screenshot visita guidata"></figure><header><h1>Quanta memoria utilizza il mio Linux?</h1><p><time datetime="2023-12-30T08:31">30 Dec 2023 </time>by <a href="https://70plus.it/authors/pasquale/" rel="author" title="Pasquale">Pasquale</a></p></header></div><div class="main__right"><div class="content__entry"><p>Ho di recente installato <a href="https://zorin.com/os/" target="_blank" rel="nofollow noopener noreferrer">Zorin OS 17</a>, la distribuzione Linux dei <a href="https://itsfoss.com/zorin-os-interview/" target="_blank" rel="nofollow noopener noreferrer">fratelli Zorin</a>.<br>Questa versione, rilasciata lo scorso 20 dicembre, ha un desktop <strong>Gnome</strong>, mentre arriverà solo nei prossimi mesi quella con <strong>XFCE</strong>, più leggera e quindi più adatta al mio Asus E210 che ha solo 4 GB di ram. Avevo quindi alcuni dubbi iniziali sulle prestazioni, in gran parte dissipati da questi primi giorni di utilizzo.</p><p>Per valutare in modo più obiettivo quando il carico di applicazioni comincia a mettere in crisi l'E210, ho rispolverato un paio di script preparati qualche tempo fa, per misurare l'occupazione della memoria e delle aree di swap con un <strong>Xubuntu (</strong>la distribuzione Linux con desktop XFCE che ho utilizzato appena prima di Zorin OS 17).</p><h3>Le aree di Swap</h3><p>Zorin OS 17 configura all'installazione un'area di swap su disco pari alla dimensione di memoria ram disponibile.<br>In questa area finiscono le pagine di memoria fisica non utilizzate di recente, quando l'esecuzione delle applicazioni richiede la disponibilità di altra memoria.</p><p>È come se la memoria fisica venisse estesa a 4 + 4 = 8 GB. Naturalmente, per poter essere utilizzate, le pagine spostate nell'area swap devono essere riportate nella memoria ram, eventualmente spostando altre pagine nello swap.<br>È intuibile che, sotto carico, si può generare un <em>andirivieni</em> di pagine tra RAM e swap, con un impatto sensibile sulle prestazioni della macchina.</p><p>Un parziale sollievo viene dalla creazione dello <strong>zswap</strong>, un'ulteriore area di swap ricavata nella memoria ram. La dimensione consigliata per l'area di zswap è di circa la metà della dimensione della memoria ram, quindi nel mio caso 2 GB.<br>Può sembrare un <em>non sense</em> spostare pagine all'interno della memoria. Ma c'è un beneficio, che viene sia dal ridotto numero di operazioni su disco, più lente della scrittura in ram, sia dalla compressione con cui le pagine vengono memorizzate nell'area di zswap.<br>Utilizzando una compressione spinta (lz4 / z3fold) si può arrivare a un rapporto di almeno 2.5.<br>Questo vuol dire che, quando i 2 GB dello zswap sono completamente occupati, il loro reale ingombro è minore di 2 GB / 2.5 = 0.8 GB.</p><h3>La raccolta dei dati di misura</h3><p>Per raccogliere i dati di occupazione della memoria e degli swap mi avvalgo di qualche comando shell e due script bash creati ad hoc, che riversano i dati raccolti in file di tipo csv.</p><p>I comandi:</p><ul><li><strong>free</strong> (mostra l'occupazione della memoria ram e quella totale degli swap)</li><li><strong>swapon</strong> (mostra l'occupazione dei singoli swap)</li><li><strong>sudo cat /sys/kernel/debug/zswap/stored_pages </strong>(restituisce il numero di pagine memorizzate nello zswap)</li><li><strong>sudo cat /sys/kernel/debug/zswap/pool_total_size </strong>(restituisce l'occupazione dello zswap, dato già fornito da <em>swapon</em>)</li></ul><p>Le due ultime misure, conoscendo la dimensione di una pagina (4096 bytes) consentono di risalire al rapporto di compressione effettivo dello zswap al momento della misura.</p><h3>Gli script</h3><p>Il primo script (newstats.sh) deve essere lanciato in due istanze, in due diverse finestre di terminale:</p><ul><li><strong>newstats.sh -a -h</strong><br>questo comando stampa nel file csv una prima riga di intestazione e poi rileva ogni 5 secondi l'occupazione di memoria e del totale degli swap, dello swap su disco e dello zswap;<br>per fermarlo basta digitare <strong>Control C</strong> nel terminale;</li><li><strong>newstats.sh</strong><br>qui viene fatta una sola misura, preceduta dalla richiesta di un input da tastiera, il cui valore verrà poi inserito nel record dati del file csv;<br>viene lanciato prima di ogni passo della lista di carico, inserendo da tastiera la descrizione del passo da effettuare.</li></ul><pre class="language-bash"><code>#!/bin/bash
#
# lancio dello script:
# ./stats.sh -a -h	: stampa header, una misura ogni 5 sec, interruzione via ^c
# ./stats.sh -a		: una misura ogni 5 sec, interruzione via ^c
# ./stats.sh -h		: stampa header, una sola misura
# ./stats.sh	 	: una sola misura 
#
if [ "$1" == "-a" ] || [ "$2" == "-a" ]
	then auto="yes"
	else auto="no"
	fi
if [ "$1" == "-h" ] || [ "$2" == "-h" ]
	then hdr="yes"
	else hdr="no"
	fi
if [ "$auto" == "yes" ]
	then
		commento="auto"
		echo interrompi l\'esecuzione con ^C
	else read -p "inserisci il commento: " commento
	fi
if [ "$hdr" == "yes" ]
	then printf "Time\tMem used\tBuffCache\tSwap used\tSwap_file\tZSwap\tcomment\tevent\n" |
        	tee -a log_swap.csv
	fi
#
while :
do
	used=$(free | awk 'BEGIN {FS=" "; OFS="\t"}
		{if ($1 == "Mem:") print $3 "-" $5}
		{if ($1 == "Swap:") print "-" $3}
		')
	MemUsed=$(echo $used | cut -f1 -d-)
	Buffcache=$(echo $used | cut -f2 -d-)
	SwapUsed=$(echo $used | cut -f3 -d-)
#
	swaps=$(swapon -s | awk 'BEGIN {FS=" "; OFS="\t"}
		{if ($1 == "/swapfile") print $4}
		{if ($1 == "/dev/zram0") print "-" $4}
		')
	Swapfile=$(echo $swaps | cut -f1 -d-)
	Swapzram=$(echo $swaps | cut -f2 -d-)
	if [ "$auto" == "yes" ]
		then
			event=""
		else
			event=$MemUsed
		fi
#
	printf "%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\n" "$(date +"%T")" "$MemUsed" "$Buffcache" "$SwapUsed" "$Swapfile" "$Swapzram" "$commento" "$event" |
        	tee -a log_swap.csv
	if [ "$auto" != "yes" ]
	then
		break
	else
		sleep 5
	fi
done</code></pre><p>Il secondo script, molto più semplice, rileva due valori relativi allo zswap: numero di pagine memorizzate e occupazione totale.</p><pre class="language-bash"><code>#!/bin/bash
#
pages=$(sudo cat /sys/kernel/debug/zswap/stored_pages)
poolsize=$(sudo cat /sys/kernel/debug/zswap/pool_total_size)
compress=$(echo "scale=3; $pages * 4096 /$poolsize;" | bc)
printf "%s\t%s\t%s\t%s\n" "$(date +"%T")" "$pages" "$poolsize" "$compress" | tee -a compressione.csv</code></pre><h3>Un esempio di dati raccolti</h3><p>I dati raccolti dai due script vengono memorizzati in due file distinti, di tipo csv, con il carattere TAB utilizzato come separatore.</p><p>Questo è un esempio di record nel file log_swap.csv:</p><pre>Time	Mem used	BuffCache	Swap used	Swap_file	ZSwap	comment	event
08:26:41	1079752	169428 	0	0 	0	auto	
08:26:46	1107060	169396 	0	0 	0	auto	
...	
08:27:32	1118884	179176 	0	0 	0	auto	
08:27:37	1117616	171208 	0	0 	0	auto	
08:27:37	1117740	171192 	0	0 	0	lancio esplora risorse e apro la lista di carico con gedit	1117740
08:27:42	1130852	182832 	0	0 	0	auto	
08:27:47	1148336	182088 	0	0 	0	auto	
</pre><p>L'ultimo campo del record, <strong>event</strong>, viene inserito in presenza di un commento, e riporta il valora del primo campo, <strong>Mem used</strong>. Questo consente di avere una visione chiara sul grafico dei dati del momento in cui è stato inserito il commento, come si vede dai <em>tic rossi</em> nell'esempio:</p><div class="gallery-wrapper"><div class="gallery" data-is-empty="false" data-translation="Add images" data-columns="1"><figure class="gallery__item"><a href="https://70plus.it/media/posts/31/gallery/log_swap.png" data-size="1145x436"><img loading="lazy" src="https://70plus.it/media/posts/31/gallery/log_swap-thumbnail.png" alt="" width="768" height="292"></a></figure></div></div><p><em>Il grafico verrà analizzato nel post successivo.</em></p><p>L'output del secondo script è più semplice. Ecco un estratto dal file <strong>compressione.csv:</strong></p><pre> 
    21:09:35	3466	2674688	5.307
    </pre><p>Qui ha vinto la pigrizia, non c'è nessuna intestazione, ma la struttura del record è molto semplice: <strong>ora - numero di pagine - occupazione - compressione</strong>.</p><h3>La campagna di misura</h3><p>Con gli script a disposizione non resta che effettuare la campagna di misure:</p><ul><li>preparare una lista di applicazioni da lanciare una dopo l'altra;</li><li>a sistema appena avviato, eseguire i passi della lista;</li><li>raccolti i dati, analizzarli con un foglio di calcolo (<strong>LibreOffice Calc</strong> oppure <strong>Excel</strong>).</li></ul><p>Il seguito al prossimo post!</p><footer><div class="content__tag-share"><ul class="content__tag"><li><a href="https://70plus.it/tags/cose-informatiche/">Cose informatiche</a></li></ul><div class="content__share"></div></div><div class="content__bio"><h3><a href="https://70plus.it/authors/pasquale/" title="Pasquale">Pasquale</a></h3><div class="content__bio-desc">Dopo innumerevoli anni da informatico, tra Ivrea e Milano, finalmente a riposo sulle rive del lago di Lecco. Scrivimi a: 70plus@libero.it</div></div></footer></div></div></article><div class="main__right main__right--bottom"></div></main><footer class="footer"><div class="footer__copyright">Powered by Publii</div></footer></div></div><script defer="defer" src="https://70plus.it/assets/js/scripts.min.js?v=1ea8317abae2e05fa2a65ed7bbff7ba7"></script><script>var images = document.querySelectorAll('img[loading]');
   
           for (var i = 0; i < images.length; i++) {
               if (images[i].complete) {
                   images[i].classList.add('is-loaded');
               } else {
                   images[i].addEventListener('load', function () {
                       this.classList.add('is-loaded');
                   }, false);
               }
           }</script></body></html>